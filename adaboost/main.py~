#!/usr/bin/env python

import numpy as np
import matplotlib.pyplot as plt
import scipy.io as sio
import adaboost


def k_fold(inputs,y,k):
    #k=7
    m=inputs.shape[0]  #total number of data:351
    step=int(m/k)  #50
    dataset=[]
    for i in range(k):
        miniset={}
        if (i+1)!=k:
            #0~50;50~100;
            miniset['testData']=inputs[i*step:(i+1)*step]  
            miniset['testlabel']=y[i*step:(i+1)*step]
            miniset['trainData']=np.concatenate((inputs[0:i*step],inputs[(i+1)*step:]),axis=0)
            miniset['trainlabel']=y[0:i*step]+y[(i+1)*step:]
        else: 
            #300~351
            miniset['testData']=inputs[i*step:]
            miniset['testlabel']=y[i*step:]
            miniset['trainData']=inputs[0:i*step]
            miniset['trainlabel']=y[0:i*step]
        dataset.append(miniset)
    print(len(dataset))
    print(dataset[0]['testData'].shape)
    print(dataset[0]['trainData'].shape)
    print(dataset[6]['testData'].shape)
    print(dataset[6]['trainData'].shape)
    return dataset


data_path = "ionosphereData.mat"
data = sio.loadmat(data_path)
inputs, targets = data['X'], list(map(lambda x: x[0][0], data['Y']))
y=[int(1) if item=='b' else int(-1) for item in targets]
dataset=k_fold(inputs,y,k=7)

sum_error_rate=0.0
for miniset in dataset:
    trainData=miniset['trainData']
    trainlabe=miniset['trainlabel']
    testData=miniset['testData']
    testlabel=miniset['testlabel']
    classifier,train_errorRate = adaboost.train(trainData,trainlabel,150)
    predict_result,predict_error_rate=adaboost.test(testData,testlabel,classifier)
    print("predict_error_rate is:",predict_error_rate)
    sum_error_rate+=predict_error_rate
average_error_rate=float(sum_error_rate)/len(dataset)
print("average_error_rate is:", average_error_rate)

    
